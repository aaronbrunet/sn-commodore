<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function(spModal,$window,$scope) {
  /* widget controller */
  var c = this;
  var data = c.data;

  c.clickCard = function(event,options){
	  console.log([event,options]);
	  if(data.allow_modal){
		options.display = 'modal';
		spModal.open({
			title: data.modal_title || 'More Information',
			widget: 'cc-event-card',
			widgetInput: options,
			buttons: options.buttons
		}).then(function(){
			console.log('Modal closed');
			$window.location.href = event.data.event_href;
		})
	  }

  };
};]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>cc-event-list</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>CC Event List</name>
        <option_schema>[{"name":"limit","section":"Presentation","default_value":"3","label":"Number of Events","type":"choice","choices":[{"label":"1","value":"1"},{"label":"3","value":"3"},{"label":"6","value":"6"},{"label":"9","value":"9"}]}]</option_schema>
        <public>false</public>
        <roles>x_snc_commodore_0.cc_user</roles>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	
	data.options = options;
	data.limit = data.options.limit;
	data.events = [];
	data.widgets = [];

	var events = new GlideRecord('x_snc_commodore_0_events');
	events.addEncodedQuery('start>=javascript:gs.beginningOfToday()^stateNOT INcompleted,cancelled');
	events.orderBy('start');
	events.query();

	while(events.next()){
		var event = {};
			event.buttons = [];
			event.sys_id = events.getValue('sys_id');
			event.live = events.getValue('state') == 'live';
			event.options = {action:'cat_item',event_id:event.sys_id,display:'list'};
			if(event.live){
				event.buttons.push({
					label: 'Join Live Event >',
					primary: true
				});
				event.href = '/cc?id=live_event&sys_id='+event.sys_id;
			} else {
				event.buttons.push({
					label: 'View Event Details >',
					primary: true
				});
				event.href = '/cc?id=event&sys_id='+event.sys_id;
			}
			event.options.buttons = event.buttons;
			console.log(event.buttons);
			data.widgets.push($sp.getWidget("cc-event-card",event.options));
			data.events.push(event);
	}
	if($sp.getParameter('id') != 'event' && $sp.getParameter('id') != 'live_event'){
		data.event_page = true;
		data.modal_title = 'Cellar Club Event Details';
		data.allow_modal = true;
	} else {
		data.allow_modal = false;
		data.event_page = false;
	}
	// console.log(data.widgets);
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>aaron.brunet</sys_created_by>
        <sys_created_on>2023-03-12 00:23:42</sys_created_on>
        <sys_id>78635c9d872da5104c1fc99d0ebb358a</sys_id>
        <sys_mod_count>80</sys_mod_count>
        <sys_name>CC Event List</sys_name>
        <sys_package display_value="Commodore's Club" source="x_snc_commodore_0">7f31176e87a021106e4b11f83cbb358d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Commodore's Club">7f31176e87a021106e4b11f83cbb358d</sys_scope>
        <sys_update_name>sp_widget_78635c9d872da5104c1fc99d0ebb358a</sys_update_name>
        <sys_updated_by>aaron.brunet</sys_updated_by>
        <sys_updated_on>2023-03-25 19:11:10</sys_updated_on>
        <template><![CDATA[<div class="cc-panel">
  <h3 class="cc-title">Upcoming Events</h3>
  <div class="cc-list-row">
    <div ng-repeat="e in data.widgets | limitTo : data.limit">
      <div ng-click="c.clickCard(e,e.options)">
      	<sp-widget widget="e"></sp-widget>
      </div>
    </div>    
  </div>  
</div>]]></template>
    </sp_widget>
</record_update>
