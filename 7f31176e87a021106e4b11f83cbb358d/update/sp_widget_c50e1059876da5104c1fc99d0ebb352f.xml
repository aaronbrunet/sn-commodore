<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function(spUtil, $scope) {
  /* widget controller */
  var c = this;
 var data = c.data;
 $scope.populate = function(){
	 
		$scope.data.loading = true;
		$scope.data.action = 'getEvent';
		spUtil.update($scope).then(function(e){				
			spUtil.get("cc-event-card",{action:'cellar_status',event_id:data.event,display:'feature'}).then(function(response){
				c.eventWidget = response;
				$scope.data.loading = false;			
			});
		});
 	};
	 $scope.populate();
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.cc-cellar-card {&#13;
	display: grid; &#13;
  grid-template-columns: 1fr 1fr; &#13;
  grid-template-rows: 1fr; &#13;
  grid-auto-rows: 1fr&#13;
  gap: 5px 5px; &#13;
}&#13;
&#13;
.left-area {&#13;
	display: flex;&#13;
  flex-direction: column;&#13;
  align-items: center;&#13;
  &#13;
  img {&#13;
  	max-width: 40vw;&#13;
    max-height: 40rem;&#13;
  }&#13;
}&#13;
.right-area {&#13;
	padding: 0 4rem;&#13;
}&#13;
&#13;
.feature {&#13;
    height: 38rem;&#13;
}&#13;
&#13;
.loading-body {&#13;
  height: 15%;&#13;
  display: block;&#13;
  animation: skeleton-loading .5s linear infinite alternate;&#13;
  margin: 2rem 0;&#13;
}&#13;
.tall {&#13;
	height: 30%;&#13;
}&#13;
&#13;
@keyframes skeleton-loading {&#13;
  0% {&#13;
    background-color: hsl(200, 20%, 80%);&#13;
  }&#13;
  100% {&#13;
    background-color: hsl(200, 20%, 95%);&#13;
  }&#13;
}&#13;
&#13;
&#13;
@media (max-width: 767px){&#13;
  .cc-cellar-card {&#13;
  	grid-template-columns: 1fr; &#13;
  }&#13;
  &#13;
  .right-area {&#13;
  	padding: 0 1rem;&#13;
  }&#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>cc-cellar-status</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>CC Cellar Status</name>
        <option_schema/>
        <public>false</public>
        <roles>x_snc_commodore_0.cc_user</roles>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	data.user = gs.getUserID();
	data.live = false;

	function getEvent(user){
		var live = new GlideRecord('x_snc_commodore_0_events');
		live.addQuery('state','live');
		live.query();
		if(live.next()){
			data.event = live.getValue('sys_id');
			data.live = true;
			console.log('live event found');
			var registered = new GlideRecord('x_snc_commodore_0_club_event_attendances');
			registered.addQuery('event',live.sys_id);
			registered.addQuery('user',user);
			registered.query();
			if(registered.next()){				
				data.href = "/cc?id=live_event&sys_id="+data.event;
			} else {
				data.href = "/cc?id=event&sys_id="+data.event;
			}			
		} else {
			console.log('no live event found');
			data.live = false;
			var next = new GlideRecord('x_snc_commodore_0_events');
			next.addEncodedQuery('start>=javascript:gs.beginningOfToday()^stateNOT INcompleted,cancelled');
			next.orderBy('start');
			next.query();
			if(next.next()){
				data.event = next.getValue('sys_id');
				data.href = "/cc?id=event&sys_id="+data.event;
			}
		}
	}

	if(input && input.action == 'getEvent'){
		getEvent(data.user);
	}
	data.cellar_img = data.live ? 'cc-cellar-open-md.png' : 'cc-cellar-closed-md.png';

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>aaron.brunet</sys_created_by>
        <sys_created_on>2023-03-12 01:07:44</sys_created_on>
        <sys_id>c50e1059876da5104c1fc99d0ebb352f</sys_id>
        <sys_mod_count>59</sys_mod_count>
        <sys_name>CC Cellar Status</sys_name>
        <sys_package display_value="Commodore's Club" source="x_snc_commodore_0">7f31176e87a021106e4b11f83cbb358d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Commodore's Club">7f31176e87a021106e4b11f83cbb358d</sys_scope>
        <sys_update_name>sp_widget_c50e1059876da5104c1fc99d0ebb352f</sys_update_name>
        <sys_updated_by>aaron.brunet</sys_updated_by>
        <sys_updated_on>2023-03-30 01:44:40</sys_updated_on>
        <template><![CDATA[<div class="cc-panel emphasis">
  <div class="cc-cellar-card">
	<div class="left-area">
  		<h1>The Cellar Is {{(data.event && data.live) ? 'Open!' : 'Closed'}}</h1>
      	<div class="cellar-img">
    		<img src="{{data.cellar_img}}" alt="Cellar Door">
    	</div>
    </div>    
    <div class="right-area">
      <h2>{{(data.event && data.live) ? 'Live':'Next'}} Event</h2>
      <div ng-switch="data.loading">
        <div ng-switch-when="true">
          <div class="cc-panel feature loading">
            <div class="loading-body"></div>
            <div class="loading-body tall"></div>
            <div class="loading-body"></div>
            <div class="loading-body"></div>
          </div>
        </div>
      	<div ng-switch-when="false">
			<sp-widget widget="c.eventWidget"/>
        </div>
      </div>
    </div>
  </div>
<!--
  <div ng-if="!data.event"  class="cc-cellar-card">
    <div class="left-area">
  		<h1>The Cellar Is Closed</h1>
        <div>
       		<img src="{{data.cellar_img}}" alt="Cellar Door"></div>
     	</div>
    <div class="right-area">
      <h2>Next Event</h2>
      <sp-widget widget="c.eventWidget"/>
    </div>
  </div>
-->
</div>]]></template>
    </sp_widget>
</record_update>
