<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function(spUtil) {
  /* widget controller */
  var c = this;
 var data = c.data;
// 	createWidget(data.event);

//   createWidget = function(value){
		spUtil.get("cc-event-card",{action:'cat_item',event_id:data.event}).then(function(response){
			c.eventWidget = response;
		});
	// };
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.cc-cellar-card {&#13;
display: grid; &#13;
  grid-template-columns: 2fr 1fr; &#13;
  grid-template-rows: 1fr; &#13;
  gap: 5px 5px; &#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>cc-cellar-status</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>CC Cellar Status</name>
        <option_schema/>
        <public>false</public>
        <roles>x_snc_commodore_0.cc_user</roles>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	data.user = gs.getUserID();
	data.event = '';
	data.live = false;
	var live = new GlideRecord('x_snc_commodore_0_events');
	live.addQuery('state','live');
	live.query();
	if(live.next()){
		var registered = new GlideRecord('x_snc_commodore_0_club_event_attendances');
		registered.addQuery('event',live.sys_id);
		registered.addQuery('user',data.user);
		registered.query();
		if(registered.next()){
			data.event = live.getValue('sys_id');
			data.live = true;
			data.href = "/cc?id=live_event&sys_id="+data.event;
		}
	} else {
		data.live = false;
		var next = new GlideRecord('x_snc_commodore_0_events');
		next.addEncodedQuery('start>=javascript:gs.beginningOfToday()^stateNOT INcompleted,cancelled');
		next.orderBy('start');
		next.query();
		if(next.next()){
			data.event = next.getValue('sys_id');
			data.href = "/cc?id=event&sys_id="+data.event;
		}
	}
	data.widgetOptions = {action:'cat_item',event_id:data.event};
	console.log(data.widgetOptions);

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>aaron.brunet</sys_created_by>
        <sys_created_on>2023-03-12 01:07:44</sys_created_on>
        <sys_id>c50e1059876da5104c1fc99d0ebb352f</sys_id>
        <sys_mod_count>20</sys_mod_count>
        <sys_name>CC Cellar Status</sys_name>
        <sys_package display_value="Commodore's Club" source="x_snc_commodore_0">7f31176e87a021106e4b11f83cbb358d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Commodore's Club">7f31176e87a021106e4b11f83cbb358d</sys_scope>
        <sys_update_name>sp_widget_c50e1059876da5104c1fc99d0ebb352f</sys_update_name>
        <sys_updated_by>aaron.brunet</sys_updated_by>
        <sys_updated_on>2023-03-13 16:52:13</sys_updated_on>
        <template><![CDATA[<div class="cc-panel">
  <div ng-if="data.event" class="cc-cellar-card">
	<div class="left-area">
  		<h1>The Cellar Is {{data.live ? 'Open!' : 'Closed'}}</h1>
    </div>
    <div class="right-area">
      <h2>{{data.live ? 'Live':'Next'}} Event</h2>
      <sp-widget widget="c.eventWidget"/>
    </div>
  </div>
  <div ng-if="!data.event"  class="cc-cellar-card">
    <div class="left-area">
  		<h1>The Cellar Is Closed</h1>
  		<h2><a href="{{data.href}}" target="_blank">No event</a></h2>
    </div>
    <div class="right-area">
      <h2>Next Event</h2>
      <sp-widget widget="c.eventWidget"/>
    </div>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
